--drop table inventory;
--drop table sales_details;
--drop table sales;
--drop table purchase_details;
--drop table purchase;
--drop table medicine;
--drop table supplier;



CREATE TABLE MEDICINE (
    MEDICINE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    GENERIC_NAME VARCHAR2(200) NOT NULL,
    CATEGORY VARCHAR2(50)NOT NULL,
    DOSAGE_FORM VARCHAR2(50)NOT NULL,
    SELL_PRICE NUMBER(10,2) DEFAULT 0,
    DESCRIPTION VARCHAR2(200),
--    STOCK NUMBER DEFAULT 0,
    ACTIVE NUMBER(1) DEFAULT 1,          
    CONSTRAINT UQ_MEDICINE UNIQUE (NAME, GENERIC_NAME, CATEGORY, DOSAGE_FORM) 
);


CREATE TABLE SUPPLIER (
    SUPPLIER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR2(100) NOT NULL,
    CONTACT VARCHAR2(50) NOT NULL,
    ADDRESS VARCHAR2(200) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    ACTIVE NUMBER(1) DEFAULT 1, 
    CONSTRAINT uq_supplier UNIQUE (NAME, CONTACT, ADDRESS, EMAIL)
);


CREATE TABLE PURCHASE (
    PURCHASE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SUPPLIER_ID NUMBER NOT NULL,
    PURCHASE_DATE DATE DEFAULT SYSDATE,
    TOTAL_AMOUNT NUMBER(10,2),
    CONSTRAINT FK_PURCHASE_SUPPLIER FOREIGN KEY (SUPPLIER_ID)
    REFERENCES SUPPLIER(SUPPLIER_ID)
);


CREATE TABLE PURCHASE_DETAILS (
    PURCHASE_DETAIL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PURCHASE_ID NUMBER NOT NULL,
    MEDICINE_ID NUMBER NOT NULL,
    BOX_QUANTITY NUMBER NOT NULL,        -- number of boxes purchased
    UNITS_PER_BOX NUMBER NOT NULL,       -- tablets per box
    COST_PER_BOX NUMBER(10,2) NOT NULL,  -- cost per box
    BATCH_NO VARCHAR2(50) NOT NULL,
    EXPIRY_DATE DATE NOT NULL,
    CONSTRAINT FK_PURCHASEDETAIL_PURCHASE FOREIGN KEY (PURCHASE_ID)
    REFERENCES PURCHASE(PURCHASE_ID),
    CONSTRAINT FK_PURCHASEDETAIL_MEDICINE FOREIGN KEY (MEDICINE_ID)
    REFERENCES MEDICINE(MEDICINE_ID)
);


CREATE TABLE INVENTORY (
    INVENTORY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MEDICINE_ID NUMBER NOT NULL,
    BATCH_NO VARCHAR2(50),
    EXPIRY_DATE DATE,
    QUANTITY NUMBER DEFAULT 0,
    ACTIVE NUMBER(1) DEFAULT 1,         
    LAST_UPDATED DATE DEFAULT SYSDATE,
    CONSTRAINT FK_INVENTORY_MEDICINE FOREIGN KEY (MEDICINE_ID)
    REFERENCES MEDICINE(MEDICINE_ID)
);


CREATE TABLE SALES (
    SALE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SALE_DATE DATE DEFAULT SYSDATE,
    TOTAL_AMOUNT NUMBER(10,2)
);


CREATE TABLE SALES_DETAILS (
    SALE_DETAIL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    SALE_ID NUMBER NOT NULL,
    MEDICINE_ID NUMBER NOT NULL,
    QUANTITY NUMBER NOT NULL,
    UNIT_PRICE NUMBER(10,2),
    SUBTOTAL NUMBER(10,2),
    CONSTRAINT FK_SALESDETAIL_SALE FOREIGN KEY (SALE_ID)
    REFERENCES SALES(SALE_ID),
    CONSTRAINT FK_SALESDETAIL_MEDICINE FOREIGN KEY (MEDICINE_ID)
    REFERENCES MEDICINE(MEDICINE_ID)
);


commit;